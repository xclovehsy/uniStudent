<!-- æ–°çš„ -->
<template>
    <view class="container"> 
          <image class="bg-img" src="/static/img/background4.png"></image>
          <view class="content">
		<u--text   size=38 align=center bold text="æ€§æ ¼æµ‹è¯•æŠ¥å‘ŠæŸ¥è¯¢"></u--text><br>
		<u--text   text="è¯·è¾“å…¥æ‚¨çš„å§“åå’Œç”µè¯" size=20></u--text>
		<!-- <u--text size=38 align=center bold text="æ€§æ ¼æµ‹è¯•æŠ¥å‘ŠæŸ¥è¯¢"></u--text>
		<u--text text="è¯·è¾“å…¥æ‚¨çš„å§“åå’Œç”µè¯"  openType="share"  v-show="true" size=20 -->
		</u--text>
		<u--form
				labelPosition="left"
				:model="model1"
				:rules="rules"
				ref="form1"
				:label-style="{'font-size':'16px'}"
		>
			<u-form-item
					label="å§“å"
					prop="userInfo.name"
					borderBottom
					ref="item1"
			>
				<u--input
						v-model="model1.userInfo.name"
						border="none"
						shape=circle
						fontSize=60%
						inputAlign=center
						placeholder="è¯·è¾“å…¥å§“å"
				></u--input>
			</u-form-item>
			<u-form-item
					label="ç”µè¯"
					prop="userInfo.stuId"
					borderBottom
					ref="item1"
			>
				<u--input
						v-model="model1.userInfo.stuId"
						border="none"
						shape=circle
						fontSize=60%
						inputAlign=center
						placeholder="è¯·è¾“å…¥ç”µè¯"
				></u--input>
			</u-form-item>
		</u--form>
		
		<u-button @click="showReport()" type="primary" icon="search" :plain="false" shape="circle" text="æŸ¥çœ‹æ€§æ ¼æµ‹è¯•æŠ¥å‘Š" class="custom-style" color="linear-gradient(to right, rgb(14, 87, 182), rgb(18, 116, 245))" ></u-button>
		<!-- <text>{{model1.userInfo}}</text> -->
		<!-- =================================æ€§æ ¼æŠ¥å‘Š=================================== -->
		<!-- <u-button></u-button> -->
		<!-- <u--text :show="true"> test</u--text> -->
		<!-- <u--text text="ä½ æ˜¯ä¸€ä¸ªæ€§æ ¼å¼€æœ—ã€ä¹è§‚çš„äººï¼Œã€‚ã€‚ã€‚ã€‚\n" openType="share" type="success" v-show="assShow"></u--text> -->
		
		<!-- <text></text>
		<text>ä¸€å¼ æ€§æ ¼é›·è¾¾å›¾</text> -->
		<!-- <canvas canvas-id="bQASfDemsxJtNjLTXlnseDWeqoSILkiz" id="bQASfDemsxJtNjLTXlnseDWeqoSILkiz" class="charts" @touchend="tap"/> -->
		<!-- æ€§æ ¼æµ‹è¯•ç»“æœ ===============================================================================-->
			<!-- ä¸ªäººä¿¡æ¯ -->
			<!-- <u-divider style="margin-left: -10%;margin-right:-10%;"  text="æ‚¨çš„æ€§æ ¼æµ‹è¯•ç»“æœå¦‚ä¸‹" :dashed="true" v-show="assShow" textSize="23" textColor="black"  lineColor="black"></u-divider>
			<u--text :text="model1.userInfo.name2" openType="share"  v-show="assShow" size=21 bold></u--text>
			<br><u--text style="padding-left: 1em;" :text="model1.userInfo.addr" openType="share"  v-show="assShow"></u--text>
			<u--text style="padding-left: 1em;":text="model1.userInfo.dis" openType="share"  v-show="assShow"></u--text> -->
			
		<!-- 	
			<text>{{model1.userInfo.name}}</text>
			<text>{{model1.userInfo.stuId}}</text>
			<text>{{model1.userInfo.addr}}</text>
			<text>{{model1.userInfo.dis}}</text> -->
			
			<!-- <br><u--text text="â­ä½ çš„æ€§æ ¼ç±»å‹è¿‘ä¼¼äº: \n" openType="share" color=black size=22 v-show="assShow"></u--text>
			
			<u--textarea style="padding-left: 2em;" v-model="model1.userInfo.stuType"  v-show="assShow"></u--textarea>
			
			<br><u--text text="â­ä½ çš„æ€§æ ¼ç‰¹ç‚¹è¿‘ä¼¼äº: \n" openType="share" color=black size=22 v-show="assShow"></u--text>
			<u--textarea style="padding-left: 2em;padding-right: 2em;" v-model="model1.userInfo.trait"  v-show="assShow" autoHeight></u--textarea>
			 -->
			<u-divider  text="æ‚¨çš„æ€§æ ¼æµ‹è¯•ç»“æœå¦‚ä¸‹" :dashed="true" v-show="assShow" textSize="23" textColor="black" lineColor="black"></u-divider>
				<u--text :text="model1.userInfo.name2" openType="share"  v-show="assShow" size=21 bold style="line-height: 300%;
		foont:size 80px;"></u--text>
				<!-- <u--text :text="model1.userInfo.stuId" openType="share"  v-show="assShow"></u--text> -->
				<u--text style="padding-left: 1em;line-height: 300%;
		foont:size 80px;" :text="model1.userInfo.addr" openType="share"  v-show="assShow"></u--text>
				<u--text style="padding-left: 1em;line-height: 300%;
		foont:size 80px;":text="model1.userInfo.dis" openType="share"  v-show="assShow"></u--text>
				
			<!-- 	
				<text>{{model1.userInfo.name}}</text>
				<text>{{model1.userInfo.stuId}}</text>
				<text>{{model1.userInfo.addr}}</text>
				<text>{{model1.userInfo.dis}}</text> -->
				
				<u--text text="â­ä½ çš„æ€§æ ¼ç±»å‹æ˜¯: \n" openType="share" color=black size=22 v-show="assShow" style="line-height: 300%;
		foont:size 80px;"></u--text>
				
				<u--textarea style="padding-left: 2em;" v-model="model1.userInfo.stuType"  v-show="assShow"></u--textarea>
				
				<u--text text="â­ä½ çš„æ€§æ ¼ç‰¹ç‚¹æ˜¯: \n" openType="share" color=black size=22 v-show="assShow" style="line-height: 300%;
		foont:size 80px;"></u--text>
			
				<u--textarea style="padding-left: 2em;padding-right: 2em;" v-model="model1.userInfo.trait"  v-show="assShow" autoHeight></u--textarea>
			
			<!-- é›·è¾¾å›¾===================================================== -->
			<canvas canvas-id="bQASfDemsxJtNjLTXlnseDWeqoSILkiz" id="bQASfDemsxJtNjLTXlnseDWeqoSILkiz"  class="charts"
			@touchend="tap" v-show="assShow"/>
			
			
			
			<!-- æ¶ˆæ¯å¼¹çª— -->
			<u-popup :show="erroshow" @close="erroClose()" @open="erroOpen()">
				<view>
					<text>{{erroMes}}</text>
				</view>
			</u-popup>
			<!-- <text>{{model1.userInfo}}</text> -->
			</u-cell-group>
			<u-popup
				:safeAreaInsetBottom="true"
				:safeAreaInsetTop="true"
				:mode="popupData.mode"
				:show="popShow"
				:round="popupData.round"
				:overlay="popupData.overlay"
				:borderRadius="popupData.borderRadius"
				:closeable="popupData.closeable"
				:closeOnClickOverlay="popupData.closeOnClickOverlay"
				@close="popClose"
				@open="popOpen"
				bgColor=#ffffff
			>
				<view
					class="u-popup-slot"
					:style="{
						width: ['bottom', 'top'].includes(popupData.mode) ? '750rpx' : '200px',
						marginTop: ['left', 'right'].includes(popupData.mode) ? '480rpx' : '0',
					}"
				>	
					<u--text :text="popMsg" v-show="msgShow" align=center bold style="margin-top: 15%;"  ></u--text>
					<!-- <u-button v-show="buShow" type="primary" icon="checkmark" :plain="false" shape="circle" text="è¿”å›" class="custom-style" color="linear-gradient(to right, rgb(14, 87, 182), rgb(18, 116, 245))"></u-button> -->
					
					<!-- è¿”å› -->
					<u-button v-show="returnShow" @click="popClose()" type="primary" style="width: 60%;" icon="arrow-leftward" :plain="false" shape="circle" text="è¿”å›å¡«å†™ä¿¡æ¯" class="custom-style" color="linear-gradient(to right, rgb(14, 87, 182), rgb(18, 116, 245))"></u-button>
					<!-- <u-button @click="clear()" type="primary" icon="close-circle" :plain="true" shape="circle" text="æ¸…ç©º" class="custom-style"></u-button> -->
					
					<!-- ä¸Šä¼ ä¸ªäººä¿¡æ¯ç•Œé¢ -->
					<navigator url="/pages/info/info" open-type="navigate" hover-class="navigator-hover">
						<u-button v-show="uploadShow" @click="popClose()" type="primary" style="width: 60%;" icon="edit-pen" :plain="true" shape="circle" text="ä¸Šä¼ ä¸ªäººä¿¡æ¯" class="custom-style" ></u-button>
					</navigator>
					
					<!-- è·³è½¬åˆ°æ€§æ ¼æµ‹è¯•ç•Œé¢ -->
					<navigator url="/pages/capTest/capTest" open-type="navigate" hover-class="navigator-hover">
						<u-button v-show="CapReportShow" @click="popClose()" type="primary"style="width: 60%;" icon="file-text-fill" :plain="true" shape="circle" text="æ€§æ ¼æµ‹è¯•" class="custom-style" ></u-button>
						<!-- <u-button icon="edit-pen" type="primary" text="èƒ½åŠ›æµ‹è¯•" shape="circle" class="btn" :plain="true" ></u-button> -->
					</navigator>

				</view>
			</u-popup>
			</view>
		<!-- åº•éƒ¨å¯¼èˆªæ  -->
		<u-tabbar
			:value="value6"
			@change="name => value6 = name"
			:fixed="true"
			:placeholder="true"
			:safeAreaInsetBottom="true"
		>
			<u-tabbar-item text="é¦–é¡µ" icon="home" ></u-tabbar-item>
			<u-tabbar-item text="æ•°æ®æ€»è§ˆ" icon="search" @click='goToDataPlane()'></u-tabbar-item>
			<u-tabbar-item text="æŠ¥é“æµç¨‹" icon="map" @click='goToRegPlane()'></u-tabbar-item>
			<u-tabbar-item text="æ€§æ ¼æµ‹è¯•" icon="edit-pen" @click='goToCapPlane()'></u-tabbar-item>
		</u-tabbar>
	</view>
	
</template>

<script>
import uCharts from '@/js_sdk/u-charts/u-charts.js';
var uChartsInstance = {};
export default {
	data() {
		return {
			cWidth: 750,
			cHeight: 500,
			showSex: false,
			value6:3,
			assShow: false,
			erroshow: false,
			erroMes:"",
			model1: {
				userInfo: {
					name: '',
					stuId: '',
					stuType:'',
					trait:'',
					addr:'',
					dis:'',
					gender: 1,
				},
			},
			// buShow: true,
			popShow: false,
			msgShow: false,
			returnShow:false,
			uploadShow: false,
			CapReportShow: false,
			popupData: {
				overlay: true,
				mode: 'center',
				round: 10,
				closeOnClickOverlay: true
			},
			popMsg: "æ‚¨æ‰€æäº¤çš„ä¿¡æ¯æœ‰è¯¯",
			rules: {
				'userInfo.name': {
					type: 'string',
					required: true,
					message: 'è¯·å¡«å†™å§“å',
					trigger: ['blur', 'change']
				},
				
				'userInfo.stuId': [
						{
							required: true, 
							message: 'è¯·è¾“å…¥æ‰‹æœºå·',
							trigger: ['change','blur'],
						},
						{
							// è‡ªå®šä¹‰éªŒè¯å‡½æ•°ï¼Œè§ä¸Šè¯´æ˜
							validator: (rule, value, callback) => {
								// ä¸Šé¢æœ‰è¯´ï¼Œè¿”å›trueè¡¨ç¤ºæ ¡éªŒé€šè¿‡ï¼Œè¿”å›falseè¡¨ç¤ºä¸é€šè¿‡
								// uni.$u.test.mobile()å°±æ˜¯è¿”å›trueæˆ–è€…falseçš„
								return uni.$u.test.mobile(value);
							},
							message: 'æ‰‹æœºå·ç ä¸æ­£ç¡®',
							// è§¦å‘å™¨å¯ä»¥åŒæ—¶ç”¨blurå’Œchange
							trigger: ['change','blur'],
						}
					],
			},
			radio: '',
			switchVal: false
		};
	},
	onReady() {
	  },
	methods: {
		openPopup() {
			this.popupData = {
				overlay: true,
				mode: 'center',
				round: 10,
				closeOnClickOverlay: true
			}
			
			uni.$u.sleep().then(() => {
				this.popShow = !this.popShow
			})
		},
		navigateBack() {
			uni.navigateBack()
		},
		popOpen() {
			// console.log('open');
		},
		popClose() {
			this.popShow = false
			// console.log('close');
		},
		erroOpen() {
		  // console.log('open');
		},
		erroClose() {
		  this.erroshow = false;
		  // console.log('close');
		},
		// å±•ç¤ºæ€§æ ¼æŠ¥å‘Š
		showReport(){
			this.assShow = false
			if(this.model1.userInfo.name == '' || this.model1.userInfo.stuId == ''){
				this.popMsg = "è¯·å¡«å†™ä¸ªäººä¿¡æ¯"
				this.msgShow = true
				this.returnShow = true
				this.uploadShow = false
				this.CapReportShow = false
				this.openPopup()
			}else if(this.model1.userInfo.stuId.length != 11){
				this.popMsg = "è¯·å¡«å†™æ­£ç¡®çš„ç”µè¯å·ç "
				this.msgShow = true
				this.returnShow = true
				this.uploadShow = false
				this.CapReportShow = false
				this.openPopup()
			}else{
				uni.request({
							  header: {
										'Content-Type': 'application/x-www-form-urlencoded'
								   }, 
							  url: "http://121.4.95.22:10085/api/capacity/getStuCapAss", //ä»…ä¸ºç¤ºä¾‹ï¼Œå¹¶éçœŸå®æ¥å£åœ°å€ã€‚
							   method: 'GET',
								   data: {
									   // stuName:this.model1.userInfo.name,
									   stuId: this.model1.userInfo.stuId,
									   name:this.model1.userInfo.name,
								   },
							   //dataType:'json',
							   success: (res) => {
										console.log(res);
										if(res.data.code == 0){
											this.popMsg = "è¯·å¡«å†™ä¸ªäººä¿¡æ¯"
											this.msgShow = true
											this.returnShow = true
											this.uploadShow = false
											this.CapReportShow = false
											this.openPopup()
										}else if(res.data.code == 1){
											this.popMsg = "æ‚¨æ‰€å¡«å†™çš„å§“åæœ‰è¯¯"
											this.msgShow = true
											this.returnShow = true
											this.uploadShow = false
											this.CapReportShow = false
											this.openPopup()
										}else if(res.data.code == 2){
											this.popMsg = "ç”µè¯æœ‰è¯¯ï¼Œè¯·ä¸Šä¼ ä¸ªäººä¿¡æ¯"
											this.msgShow = true
											this.returnShow = true
											this.uploadShow = true
											this.CapReportShow = false
											this.openPopup()
										}else if(res.data.code == 3){
											this.popMsg = "è¯·å…ˆè¿›è¡Œæ€§æ ¼æµ‹è¯•"
											this.msgShow = true
											this.returnShow = false
											this.uploadShow = false
											this.CapReportShow = true
											this.openPopup()
										}else if(res.data.code == 4){
											// æˆåŠŸè·å–ä¿¡æ¯
											this.model1.userInfo.name = res.data.stuName
											this.model1.userInfo.name2 ="ğŸŒ¹äº²çˆ±çš„"+res.data.stuName+"ï¼Œä½ å¥½ï¼"
											this.model1.userInfo.stuId = res.data.stuId
											this.model1.userInfo.stuType = res.data.data.stuType
											this.model1.userInfo.trait = res.data.data.stuTrait
											this.model1.userInfo.addr ="ğŸ—ºç”Ÿæºåœ°ï¼š" +res.data.stuCity
											this.model1.userInfo.dis ="ğŸ©ä¸“ä¸šï¼š"+ res.data.stuDis
											this.model1.userInfo.gender = res.data.gender;
				//è¿™é‡Œçš„ 750 å¯¹åº” css .charts çš„ width
											// this.cWidth = uni.upx2px(750);
											// //è¿™é‡Œçš„ 500 å¯¹åº” css .charts çš„ height
											// this.cHeight = uni.upx2px(200);
											this.cWidth = uni.upx2px(750);
											//è¿™é‡Œçš„ 500 å¯¹åº” css .charts çš„ height
											this.cHeight = uni.upx2px(500);
											// this.getServerData();
											this.assShow = true;
											this.drawCharts('bQASfDemsxJtNjLTXlnseDWeqoSILkiz', res.data.data.trait);
											
										}else{
											this.popMsg = "å…¶ä»–é”™è¯¯ï¼Œè¯·è”ç³»å¼€å‘äººå‘˜"
											this.msgShow = true
											this.returnShow = false
											this.uploadShow = false
											this.CapReportShow = false
											this.openPopup()
										}
										
										
										
										//-----------------------ç­‰åç«¯å®ç°------------------------------------------
										// console.log(res.data.data.trait)
										// console.log(res.data.data.trait)
										  
										
								   } 
							   })
			}
			
			
				   
				   
			
		},

		goToCapPlane(){
			uni.navigateTo({
				url: "/pages/CapAssess/CapAssess"
				// icon:'success'
			})
		},

		goToDataPlane(){
			// console.log("dataplane")
			uni.navigateTo({
				url: "/pages/plane/plane"
				// icon:'success'
			})
		},
		goToRegPlane(){
			// console.log('go to regPlane')
			uni.navigateTo({
				url: "/pages/stuGuide/stuGuide"
				// icon:'success'
			})
		},
		goToMainPlane(){
			// console.log('go to regPlane')
			uni.navigateTo({
				url: "/pages/schoolInfo/schoolInfo"
				// icon:'success'
			})
		},
		getServerData() {
		      //æ¨¡æ‹Ÿä»æœåŠ¡å™¨è·å–æ•°æ®æ—¶çš„å»¶æ—¶
		      
		    },
		    drawCharts(id,data){
				if(this.model1.userInfo.gender == 1){
					const ctx = uni.createCanvasContext(id, this);
					uChartsInstance[id] = new uCharts({
					  type: "radar",
					  context: ctx,
					  width: this.cWidth,
					  height: this.cHeight,
					  categories: data.categories,
					  series: data.series,
					  animation: true,
					  background: "#FFFFFF",
					  color: ["#1890FF","#91CB74","#FAC858","#EE6666","#73C0DE","#3CA272","#FC8452","#9A60B4","#ea7ccc"],
					  padding: [5,5,5,5],
					  dataLabel: false,
					  legend: {
					    show: false,
					    position: "right",
					    lineHeight: 25
					  },
					  extra: {
					    radar: {
					      gridType: "circle",
					      gridColor: "#CCCCCC",
					      gridCount: 3,
					      opacity: 0.2,
					      max: 5
					    }
					  }
					});
				}else{
					const ctx = uni.createCanvasContext(id, this);
					uChartsInstance[id] = new uCharts({
					  type: "radar",
					  context: ctx,
					  width: this.cWidth,
					  height: this.cHeight,
					  categories: data.categories,
					  series: data.series,
					  animation: true,
					  background: "#FFFFFF",
					  color: ["#ffaaff","#91CB74","#FAC858","#EE6666","#73C0DE","#3CA272","#FC8452","#9A60B4","#ea7ccc"],
					  padding: [5,5,5,5],
					  dataLabel: false,
					  legend: {
					    show: false,
					    position: "right",
					    lineHeight: 25
					  },
					  extra: {
					    radar: {
					      gridType: "circle",
					      gridColor: "#CCCCCC",
					      gridCount: 3,
					      opacity: 0.2,
					      max: 5
					    }
					  }
					});
				}
				
		      
		    },
		    tap(e){
		      uChartsInstance[e.target.id].touchLegend(e);
		      uChartsInstance[e.target.id].showToolTip(e);
		    }
		  },

};
</script>
<style>
	.u-text{
		font-family: 'Times New Roman', Times, serif;
		font-weight: bold;
		border-radius: 20%;
		box-sizing: border-box;
		border-bottom: 10px;
		border-width: 15px;
	}
	.u-input{
		font-size: 35px;
		height: 50%;
		border-style: dashed;
	}
	.u-form-item{
		padding-left: 5%;
		/* size: 50px; */
		width:80%;
		/* height: 20px; */
	}
	.u-popup-slot {
		width: 200px;
		height: 150px;
		// @include flex;
		justify-content: center;
		align-items: center;
	}
	.custom-style {
			margin-top: 10px;
			color: #ffffff;
			width: 400rpx;
			font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
		}
	.btn {
	    width: 500rpx;
	    height: 72rpx;
	    border: 2rpx solid #f4f4f4;
	    border-radius: 36rpx;
	    /* margin: auto; */
	    background: transparent;
	    font-size: 28rpx;
	    line-height: 72rpx;
	    color: #faf6f4;
		background-color: dodgerblue;
	    
		}
	  .charts{
			margin-bottom: 0%;
			margin-left: -4%;
			margin-right:0%;
	  		width: 440px;
	  		height: 360px;
	  		background-color: #ffffff;
	   }
	   // ä»¥ä¸‹ä¸º style åŒºåŸŸ
	   .bg-img{
	   	position: fixed;
	   	width: 100%;
	   	height: 100%;
	   	top: 0;
	   	left: 0;
	   	z-index: -1;
	   }
	   .content{
	   	font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
	   	padding-left: 5%;
	   	padding-right: 5%;
	   }
</style>